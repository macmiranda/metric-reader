# Metric Reader Configuration File
# All settings in this file can be overridden by environment variables
# by using uppercase names (e.g., LOG_LEVEL, METRIC_NAME)

# Logging configuration
log_level = "info"  # Options: debug, info, warn, error

# Metric configuration
metric_name = "up"
label_filters = ""  # Optional: e.g., 'job="prometheus",instance="localhost:9090"'

# Threshold configuration
threshold_operator = "greater_than"  # Options: "greater_than" or "less_than"

# Soft threshold configuration (new recommended structure)
[soft]
threshold = 80.0  # Soft threshold value
plugin = "log_action"  # Plugin to execute when soft threshold is exceeded
duration = "30s"  # How long threshold must be exceeded
backoff_delay = "1m"  # Delay between actions after threshold is triggered

# Hard threshold configuration (new recommended structure)
[hard]
threshold = 100.0  # Hard threshold value
plugin = "file_action"  # Plugin to execute when hard threshold is exceeded
duration = "30s"  # How long threshold must be exceeded
backoff_delay = "1m"  # Delay between actions after threshold is triggered

# Legacy flat threshold configuration (deprecated, use [soft] and [hard] sections instead)
# soft_threshold = 80.0
# hard_threshold = 100.0
# soft_threshold_plugin = "log_action"
# hard_threshold_plugin = "file_action"
# threshold_duration = "30s"
# backoff_delay = "1m"

# Polling configuration
polling_interval = "15s"  # How often to check the metric

# Prometheus configuration
prometheus_endpoint = "http://prometheus:9090"

# Plugin configuration
plugin_dir = ""  # Optional: directory containing plugin .so files

# Leader election configuration (for Kubernetes deployments)
leader_election_enabled = true
leader_election_lock_name = "metric-reader-leader"
# leader_election_lock_namespace is optional - if not set, uses the pod's namespace
# leader_election_lock_namespace = "custom-namespace"

# Plugin-specific configuration
# New nested structure recommended for better organization
[plugins.file_action]
dir = "/tmp/metric-files"
size = 104857600  # Size in bytes (100MB shown here, default is 1MB)

[plugins.efs_emergency]
# Note: At least one of file_system_id or file_system_prometheus_label must be set
# file_system_id = "fs-0123456789abcdef0"  # Static EFS filesystem ID (optional if using label)
# file_system_prometheus_label = "file_system_id"  # Prometheus label containing filesystem ID (optional if using static ID)
# aws_region = "us-east-1"  # AWS region (optional, auto-detected by AWS SDK if not set)
